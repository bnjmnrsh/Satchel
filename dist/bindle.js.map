{"version":3,"file":"bindle.js","sources":["../src/bindle.js"],"sourcesContent":["/**\n * Tools for managing Satchel pockets.\n */\n\n/**\n * Emit custom event for Satchel pocket opperations.\n *\n * @param {object} detail Event details\n * @property {string|null} detail.pocket name of the Storage pocket being cleaned\n * @property {number|null} detail.keysBefore then number of keys in the pocket before emptyPocket or tidyPocket\n * @property {number|null} detail.keysAfter then number of keys in the pocket after emptyPocket or tidyPocket\n * @property {string} detail.storageArea, the type of Storage object\n * @property {string} detail.url, the url of the document whoes key changed\n * @property {string} detail.action the name of the Satchel function emiting the event\n * @returns {CustomEvent} CustomEvent\n */\nfunction emitPocket(detail = {}) {\n  const required = {\n    action: null,\n\n    pocket: null,\n    remainingPocketKeys: null,\n    startingPocketKeys: null,\n    remainingKeysInStore: null,\n    storageArea: null,\n    url: window.location.href\n  }\n  detail = { ...required, ...detail }\n  const event = new CustomEvent('Satchel', {\n    bubbles: true,\n    cancelable: true,\n    detail\n  })\n  return document.dispatchEvent(event)\n}\n\n/**\n * Get the Storage type as a string 'localStorage' or 'sessionStorage'.\n *\n * @param {object} Storage object\n * @returns {string} the Storage type as a string 'localStorage' or 'SessionStorage'\n */\nfunction storageAreaString(store) {\n  return store === window.localStorage ? 'LocalStorage' : 'SessionStorage'\n}\n\n/**\n * Returns array of keys for a 'Pocket' namespace.\n *\n * @param {string} pocket namespace prefix, default 'pocket'\n * @param {boolean} local specify sessionStorage (default) or localStorage\n * @returns {array} array of Storage keys for the current pocket.\n */\nfunction getAllPocketKeys(local = false, pocket = 'pocket', stcl = 'stcl') {\n  const store = local ? window.localStorage : window.sessionStorage\n\n  const allKeys = Object.keys(store)\n    .map((key) => {\n      return key.startsWith(stcl + '.' + pocket) ? key : ''\n    })\n    .filter((e) => {\n      return e\n    })\n\n  return Array.from(allKeys)\n}\n\n/**\n *  Removes all expired items from a given 'pocket' namespace.\n *\n * @param {string} pocket namespace prefix, default 'pocket'\n * @param {boolean} local specify sessionStorage (default) or localStorage\n * @returns The number of items remaing in store that have yet to expire.\n */\nfunction tidyPocket(local = false, pocket = 'pocket', stcl = 'stcl') {\n  const store = local ? window.localStorage : window.sessionStorage\n  const pocketKeys = getAllPocketKeys(local, pocket, stcl)\n  if (!pocketKeys.length) return null\n\n  Object.keys(pocketKeys).forEach((key) => {\n    const expiry = JSON.parse(store.getItem(pocketKeys[key])).expiry\n    if (!expiry || expiry - Date.now() > 0) return null\n    store.removeItem(pocketKeys[key])\n  })\n\n  emitPocket(\n    {\n      action: 'tidyPocket',\n      pocket: pocket,\n      remainingPocketKeys: getAllPocketKeys(local, pocket, stcl).length,\n      remainingKeysInStore: store.length,\n      startingPocketKeys: pocketKeys.length,\n      storageArea: storageAreaString(store)\n    },\n    true\n  )\n  return [getAllPocketKeys(local, pocket).length, store.length]\n}\n\n/**\n * Clears all items regardless of freshness from a given 'pocket' namespace.\n *\n * @param {boolean} local specify sessionStorage (default) or localStorage\n * @param {string} pocket namespace prefix, default 'pocket'\n * @returns {array|null} The number of pocket-keys remaing in store, which if sucessful should be [0, store.length].\n */\nfunction emptyPocket(local = false, pocket = 'pocket', stcl = 'stcl') {\n  const store = local ? window.localStorage : window.sessionStorage\n  const pocketKeys = getAllPocketKeys(local, pocket, stcl)\n  if (!pocketKeys.length) return null\n\n  Object.keys(pocketKeys).forEach((key) => {\n    store.removeItem(pocketKeys[key])\n  })\n\n  const remainingPocketKeys = getAllPocketKeys(local, pocket, stcl)\n\n  emitPocket(\n    {\n      action: 'emptyPocket',\n      pocket: pocket,\n      remainingPocketKeys: remainingPocketKeys.length,\n      remainingKeysInStore: store.length,\n      startingPocketKeys: pocketKeys.length,\n      storageArea: storageAreaString(store)\n    },\n    true\n  )\n  return [remainingPocketKeys.length, store.length]\n}\n\nexport { emptyPocket, tidyPocket, getAllPocketKeys }\n"],"names":[],"mappings":"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"}