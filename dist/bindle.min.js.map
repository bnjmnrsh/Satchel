{"version":3,"file":"bindle.min.js","sources":["../src/bindle.js"],"sourcesContent":["/**\n * Tools for managing Satchel pockets.\n */\n\n/**\n * Emit custom event for Satchel pocket opperations.\n *\n * @param {object} detail Event details\n * @property {string|null} detail.pocket name of the Storage pocket being cleaned\n * @property {number|null} detail.keysBefore then number of keys in the pocket before emptyPocket or tidyPocket\n * @property {number|null} detail.keysAfter then number of keys in the pocket after emptyPocket or tidyPocket\n * @property {string} detail.storageArea, the type of Storage object\n * @property {string} detail.url, the url of the document whoes key changed\n * @property {string} detail.action the name of the Satchel function emiting the event\n * @returns {CustomEvent} CustomEvent\n */\nfunction emitPocket(detail = {}) {\n  const required = {\n    action: null,\n\n    pocket: null,\n    remainingPocketKeys: null,\n    startingPocketKeys: null,\n    remainingKeysInStore: null,\n    storageArea: null,\n    url: String(window.location.href)\n  }\n  detail = { ...required, ...detail }\n  const event = new CustomEvent('Satchel', {\n    bubbles: true,\n    cancelable: true,\n    detail\n  })\n  return document.dispatchEvent(event)\n}\n\n/**\n * Get the Storage type as a string 'localStorage' or 'sessionStorage'\n *\n * @param {object} Storage object\n * @returns {string} the Storage type as a string 'localStorage' or 'SessionStorage'\n */\nfunction storageAreaString(store) {\n  return store === window.localStorage ? 'LocalStorage' : 'SessionStorage'\n}\n\n/**\n * Returns array of keys for a 'Pocket' namespace.\n *\n * @param {string} pocket namespace prefix, default 'pocket'\n * @param {boolean} local specify sessionStorage (default) or localStorage\n * @returns {array} array of Storage keys for the current pocket.\n */\nfunction getAllPocketKeys(local = false, pocket = 'pocket', stcl = 'stcl') {\n  const store = local ? window.localStorage : window.sessionStorage\n\n  const allKeys = Object.keys(store)\n    .map((key) => {\n      return key.startsWith(stcl + '.' + pocket) ? key : ''\n    })\n    .filter((e) => {\n      return e\n    })\n\n  return Array.from(allKeys)\n}\n\n/**\n *  Removes all expired items from a given 'pocket' namespace\n *\n * @param {string} pocket namespace prefix, default 'pocket'\n * @param {boolean} local specify sessionStorage (default) or localStorage\n * @returns The number of items remaing in store that have yet to expire.\n */\nfunction tidyPocket(local = false, pocket = 'pocket', stcl = 'stcl') {\n  const store = local ? window.localStorage : window.sessionStorage\n  const pocketKeys = getAllPocketKeys(local, pocket)\n  if (!pocketKeys.length) return null\n\n  Object.keys(pocketKeys).forEach((key) => {\n    const expiry = JSON.parse(store.getItem(pocketKeys[key])).expiry\n    if (!expiry || expiry - Date.now() > 0) return null\n    store.removeItem(pocketKeys[key])\n  })\n  const remainingPocketKeys = getAllPocketKeys(local, pocket)\n\n  emitPocket(\n    {\n      action: 'tidyPocket',\n      pocket: String(pocket),\n      remainingPocketKeys: getAllPocketKeys(local, pocket).length,\n      startingPocketKeys: Number(pocketKeys.length),\n      remainingKeysInStore: Number(store.length),\n      storageArea: String(storageAreaString(store))\n    },\n    true\n  )\n  return [remainingPocketKeys.length, store.length]\n}\n\n/**\n * Clears all items regardless of freshness from a given 'pocket' namespace\n *\n * @param {boolean} local specify sessionStorage (default) or localStorage\n * @param {string} pocket namespace prefix, default 'pocket'\n * @returns {array} The number of poket keys remaing in store, which if sucessful should be 0.\n */\nfunction emptyPocket(local = false, pocket = 'pocket', stcl = 'stcl') {\n  const store = local ? window.localStorage : window.sessionStorage\n  const pocketKeys = getAllPocketKeys(local, pocket)\n\n  Object.keys(pocketKeys).forEach((key) => {\n    store.removeItem(pocketKeys[key])\n  })\n\n  const remainingPocketKeys = getAllPocketKeys(local, pocket)\n\n  emitPocket(\n    {\n      action: 'emptyPocket',\n      pocket: String(pocket),\n      remainingPocketKeys: Number(remainingPocketKeys.length),\n      startingPocketKeys: Number(pocketKeys.length),\n      remainingKeysInStore: Number(store.length),\n      storageArea: String(storageAreaString(store))\n    },\n    true\n  )\n  return [remainingPocketKeys.length, store.length]\n}\n\nexport { emptyPocket, tidyPocket, getAllPocketKeys }\n"],"names":["emitPocket","detail","action","pocket","remainingPocketKeys","startingPocketKeys","remainingKeysInStore","storageArea","url","String","window","location","href","event","CustomEvent","bubbles","cancelable","document","dispatchEvent","storageAreaString","store","localStorage","getAllPocketKeys","local","stcl","sessionStorage","allKeys","Object","keys","map","key","startsWith","filter","e","Array","from","tidyPocket","pocketKeys","length","forEach","expiry","JSON","parse","getItem","Date","now","removeItem","Number","emptyPocket"],"mappings":";AAgBA,SAASA,EAAWC,EAAS,IAW3BA,EAAS,IAVQ,CACfC,OAAQ,KAERC,OAAQ,KACRC,oBAAqB,KACrBC,mBAAoB,KACpBC,qBAAsB,KACtBC,YAAa,KACbC,IAAKC,OAAOC,OAAOC,SAASC,UAEHX,GAC3B,MAAMY,EAAQ,IAAIC,YAAY,UAAW,CACvCC,SAAS,EACTC,YAAY,EACZf,WAEF,OAAOgB,SAASC,cAAcL,EAChC,CAQA,SAASM,EAAkBC,GACzB,OAAOA,IAAUV,OAAOW,aAAe,eAAiB,gBAC1D,CASA,SAASC,EAAiBC,GAAQ,EAAOpB,EAAS,SAAUqB,EAAO,QACjE,MAAMJ,EAAQG,EAAQb,OAAOW,aAAeX,OAAOe,eAE7CC,EAAUC,OAAOC,KAAKR,GACzBS,KAAKC,GACGA,EAAIC,WAAWP,EAAO,IAAMrB,GAAU2B,EAAM,KAEpDE,QAAQC,GACAA,IAGX,OAAOC,MAAMC,KAAKT,EACpB,CASA,SAASU,EAAWb,GAAQ,EAAOpB,EAAS,SAAUqB,EAAO,QAC3D,MAAMJ,EAAQG,EAAQb,OAAOW,aAAeX,OAAOe,eAC7CY,EAAaf,EAAiBC,EAAOpB,GAC3C,IAAKkC,EAAWC,OAAQ,OAAO,KAE/BX,OAAOC,KAAKS,GAAYE,SAAST,IAC/B,MAAMU,EAASC,KAAKC,MAAMtB,EAAMuB,QAAQN,EAAWP,KAAOU,OAC1D,IAAKA,GAAUA,EAASI,KAAKC,MAAQ,EAAG,OAAO,KAC/CzB,EAAM0B,WAAWT,EAAWP,GAAK,IAEnC,MAAM1B,EAAsBkB,EAAiBC,EAAOpB,GAapD,OAXAH,EACE,CACEE,OAAQ,aACRC,OAAQM,OAAON,GACfC,oBAAqBkB,EAAiBC,EAAOpB,GAAQmC,OACrDjC,mBAAoB0C,OAAOV,EAAWC,QACtChC,qBAAsByC,OAAO3B,EAAMkB,QACnC/B,YAAaE,OAAOU,EAAkBC,MAInC,CAAChB,EAAoBkC,OAAQlB,EAAMkB,OAC5C,CASA,SAASU,EAAYzB,GAAQ,EAAOpB,EAAS,SAAUqB,EAAO,QAC5D,MAAMJ,EAAQG,EAAQb,OAAOW,aAAeX,OAAOe,eAC7CY,EAAaf,EAAiBC,EAAOpB,GAE3CwB,OAAOC,KAAKS,GAAYE,SAAST,IAC/BV,EAAM0B,WAAWT,EAAWP,GAAK,IAGnC,MAAM1B,EAAsBkB,EAAiBC,EAAOpB,GAapD,OAXAH,EACE,CACEE,OAAQ,cACRC,OAAQM,OAAON,GACfC,oBAAqB2C,OAAO3C,EAAoBkC,QAChDjC,mBAAoB0C,OAAOV,EAAWC,QACtChC,qBAAsByC,OAAO3B,EAAMkB,QACnC/B,YAAaE,OAAOU,EAAkBC,MAInC,CAAChB,EAAoBkC,OAAQlB,EAAMkB,OAC5C"}