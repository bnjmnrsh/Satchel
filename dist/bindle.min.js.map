{"version":3,"file":"bindle.min.js","sources":["../src/bindle.js"],"sourcesContent":["/**\n * Tools for managing Satchel pockets.\n */\n\n/**\n * Emit custom event for Satchel pocket opperations.\n *\n * @param {object} detail Event details\n * @property {string|null} detail.pocket name of the Storage pocket being cleaned\n * @property {number|null} detail.keysBefore then number of keys in the pocket before emptyPocket or tidyPocket\n * @property {number|null} detail.keysAfter then number of keys in the pocket after emptyPocket or tidyPocket\n * @property {string} detail.storageArea, the type of Storage object\n * @property {string} detail.url, the url of the document whoes key changed\n * @property {string} detail.action the name of the Satchel function emiting the event\n * @returns {CustomEvent} CustomEvent\n */\nfunction emitPocket(detail = {}) {\n  const required = {\n    action: null,\n    pocket: null,\n    remainingPocketKeys: null,\n    startingPocketKeys: null,\n    remainingKeysInStore: null,\n    storageArea: null,\n    url: window.location.href\n  }\n  detail = { ...required, ...detail }\n  const event = new CustomEvent('Satchel', {\n    bubbles: true,\n    cancelable: true,\n    detail\n  })\n  return document.dispatchEvent(event)\n}\n\n/**\n * Get the Storage type as a string 'localStorage' or 'sessionStorage'.\n *\n * @param {object} Storage object\n * @returns {string} the Storage type as a string 'localStorage' or 'SessionStorage'\n */\nfunction storageAreaString(store) {\n  return store === window.localStorage ? 'LocalStorage' : 'SessionStorage'\n}\n\n/**\n * Returns array of keys for a 'Pocket' namespace.\n *\n * @param {string} pocket namespace prefix, default 'pocket'\n * @param {boolean} local specify sessionStorage (default) or localStorage\n * @returns {array} array of Storage keys for the current pocket.\n */\nfunction getAllPocketKeys(local = false, pocket = 'pocket', stcl = 'stcl') {\n  const store = local ? window.localStorage : window.sessionStorage\n\n  const allKeys = Object.keys(store)\n    .map((key) => {\n      return key.startsWith(stcl + '.' + pocket) ? key : ''\n    })\n    .filter((e) => {\n      return e\n    })\n\n  return Array.from(allKeys)\n}\n\n/**\n *  Removes all expired items from a given 'pocket' namespace.\n *\n * @param {string} pocket namespace prefix, default 'pocket'\n * @param {boolean} local specify sessionStorage (default) or localStorage\n * @returns The number of items remaing in store that have yet to expire.\n */\nfunction tidyPocket(local = false, pocket = 'pocket', stcl = 'stcl') {\n  const store = local ? window.localStorage : window.sessionStorage\n  const pocketKeys = getAllPocketKeys(local, pocket, stcl)\n  if (!pocketKeys.length) return null\n\n  Object.keys(pocketKeys).forEach((key) => {\n    const expiry = JSON.parse(store.getItem(pocketKeys[key])).expiry\n    if (!expiry || expiry - Date.now() > 0) return null\n    store.removeItem(pocketKeys[key])\n  })\n\n  emitPocket(\n    {\n      action: 'tidyPocket',\n      pocket,\n      remainingPocketKeys: getAllPocketKeys(local, pocket, stcl).length,\n      remainingKeysInStore: store.length,\n      startingPocketKeys: pocketKeys.length,\n      storageArea: storageAreaString(store)\n    },\n    true\n  )\n  return [getAllPocketKeys(local, pocket).length, store.length]\n}\n\n/**\n * Clears all items regardless of freshness from a given 'pocket' namespace.\n *\n * @param {boolean} local specify sessionStorage (default) or localStorage\n * @param {string} pocket namespace prefix, default 'pocket'\n * @returns {array|null} The number of pocket-keys remaing in store, which if sucessful should be [0, store.length].\n */\nfunction emptyPocket(local = false, pocket = 'pocket', stcl = 'stcl') {\n  const store = local ? window.localStorage : window.sessionStorage\n  const pocketKeys = getAllPocketKeys(local, pocket, stcl)\n  if (!pocketKeys.length) return null\n\n  Object.keys(pocketKeys).forEach((key) => {\n    store.removeItem(pocketKeys[key])\n  })\n\n  const remainingPocketKeys = getAllPocketKeys(local, pocket, stcl)\n\n  emitPocket(\n    {\n      action: 'emptyPocket',\n      pocket,\n      remainingPocketKeys: remainingPocketKeys.length,\n      remainingKeysInStore: store.length,\n      startingPocketKeys: pocketKeys.length,\n      storageArea: storageAreaString(store)\n    },\n    true\n  )\n  return [remainingPocketKeys.length, store.length]\n}\n\nexport { emptyPocket, tidyPocket, getAllPocketKeys }\n"],"names":["emitPocket","detail","action","pocket","remainingPocketKeys","startingPocketKeys","remainingKeysInStore","storageArea","url","window","location","href","event","CustomEvent","bubbles","cancelable","document","dispatchEvent","storageAreaString","store","localStorage","getAllPocketKeys","local","stcl","sessionStorage","allKeys","Object","keys","map","key","startsWith","filter","e","Array","from","tidyPocket","pocketKeys","length","forEach","expiry","JSON","parse","getItem","Date","now","removeItem","emptyPocket"],"mappings":";AAgBA,SAASA,EAAWC,EAAS,IAU3BA,EAAS,IATQ,CACfC,OAAQ,KACRC,OAAQ,KACRC,oBAAqB,KACrBC,mBAAoB,KACpBC,qBAAsB,KACtBC,YAAa,KACbC,IAAKC,OAAOC,SAASC,SAEIV,GAC3B,MAAMW,EAAQ,IAAIC,YAAY,UAAW,CACvCC,SAAS,EACTC,YAAY,EACZd,WAEF,OAAOe,SAASC,cAAcL,EAChC,CAQA,SAASM,EAAkBC,GACzB,OAAOA,IAAUV,OAAOW,aAAe,eAAiB,gBAC1D,CASA,SAASC,EAAiBC,GAAQ,EAAOnB,EAAS,SAAUoB,EAAO,QACjE,MAAMJ,EAAQG,EAAQb,OAAOW,aAAeX,OAAOe,eAE7CC,EAAUC,OAAOC,KAAKR,GACzBS,KAAKC,GACGA,EAAIC,WAAWP,EAAO,IAAMpB,GAAU0B,EAAM,KAEpDE,QAAQC,GACAA,IAGX,OAAOC,MAAMC,KAAKT,EACpB,CASA,SAASU,EAAWb,GAAQ,EAAOnB,EAAS,SAAUoB,EAAO,QAC3D,MAAMJ,EAAQG,EAAQb,OAAOW,aAAeX,OAAOe,eAC7CY,EAAaf,EAAiBC,EAAOnB,EAAQoB,GACnD,OAAKa,EAAWC,QAEhBX,OAAOC,KAAKS,GAAYE,SAAST,IAC/B,MAAMU,EAASC,KAAKC,MAAMtB,EAAMuB,QAAQN,EAAWP,KAAOU,OAC1D,IAAKA,GAAUA,EAASI,KAAKC,MAAQ,EAAG,OAAO,KAC/CzB,EAAM0B,WAAWT,EAAWP,GAAK,IAGnC7B,EACE,CACEE,OAAQ,aACRC,SACAC,oBAAqBiB,EAAiBC,EAAOnB,EAAQoB,GAAMc,OAC3D/B,qBAAsBa,EAAMkB,OAC5BhC,mBAAoB+B,EAAWC,OAC/B9B,YAAaW,EAAkBC,KAI5B,CAACE,EAAiBC,EAAOnB,GAAQkC,OAAQlB,EAAMkB,SAnBvB,IAoBjC,CASA,SAASS,EAAYxB,GAAQ,EAAOnB,EAAS,SAAUoB,EAAO,QAC5D,MAAMJ,EAAQG,EAAQb,OAAOW,aAAeX,OAAOe,eAC7CY,EAAaf,EAAiBC,EAAOnB,EAAQoB,GACnD,IAAKa,EAAWC,OAAQ,OAAO,KAE/BX,OAAOC,KAAKS,GAAYE,SAAST,IAC/BV,EAAM0B,WAAWT,EAAWP,GAAK,IAGnC,MAAMzB,EAAsBiB,EAAiBC,EAAOnB,EAAQoB,GAa5D,OAXAvB,EACE,CACEE,OAAQ,cACRC,SACAC,oBAAqBA,EAAoBiC,OACzC/B,qBAAsBa,EAAMkB,OAC5BhC,mBAAoB+B,EAAWC,OAC/B9B,YAAaW,EAAkBC,KAI5B,CAACf,EAAoBiC,OAAQlB,EAAMkB,OAC5C"}