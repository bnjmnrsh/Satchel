/* ! @preserve satchel v1.0.0 | (c) 2022 bnjmnrsh | ISC | https://github.com/bnjmnrsh/ */
var satchel=function(e){"use strict";class t{#e;#t;#s;constructor(e=null,s={},r=!1,o="pocket"){if(this.#t=r?window.localStorage:window.sessionStorage,!e)throw new Error("Satchel: a key is required.");this.stcl=t.stcl,this.#e=`${this.stcl}.${o}.${e}`,this.#s={data:void 0,expiry:null},s={...this.#s,...s},this.set(s)}age(){const e=JSON.parse(this.#t.getItem(this.#e));return{age:Date.now()-e.creation,creation:e.creation,expiry:e.expiry,fresh:this.isFresh()}}bin(){const e=this.#t.getItem(this.#e);if(this.#t.removeItem(this.#e),!this.#t.getItem(this.#e))return t.#r({key:this.#e,oldValue:e,storageArea:t.#o(this.#t),action:"bin"}),!0}get(e=!1){const t=this.#t.getItem(this.#e);return!!t&&(!!(this.isFresh()&&!e||e)&&JSON.parse(t))}set({data:e,expiry:s}){if("number"!=typeof s&&null!==s)throw new Error("Satchel: Expiry must be null or a number.");const r=this.get(!0),o={};if(o.data=e||null,o.expiry=s||null,!e&&!s&&r)throw new Error(`Satchel: The key ("${this.#e}") already exists in ${t.#o(this.#t)}, and "data" and "expiry" atributes have not been set, set these or create a new unique key.`);return o.creation=r.creation||Date.now(),this.#t.setItem(this.#e,JSON.stringify(o)),t.#r({key:this.#e,newValue:JSON.stringify(o),oldValue:r||null,storageArea:t.#o(this.#t),action:"set"}),this}isFresh(){const e=JSON.parse(this.#t.getItem(this.#e));return!e?.expiry||e.expiry-Date.now()>0}getKey(){return this.#e}static getAllPocketKeys(e="pocket",t=!1){const s=t?window.localStorage:window.sessionStorage;return Object.keys(s).map((t=>t.startsWith(this.stcl+"."+e)?t:"")).filter((function(e){return e}))}static#o(e){return e===localStorage?"LocalStorage":"SessionStorage"}static#r(e={},t=!1){let s={key:null,newValue:null,oldValue:null,storageArea:null,url:window.location.href||null,action:null};t&&(s={pocket:null,keysBefore:null,keysRemaining:null,storageArea:null,url:window.location.href||null,action:null}),e={...s,...e};const r=new CustomEvent("Satchel",{bubbles:!0,cancelable:!0,detail:e});return document.dispatchEvent(r)}static emptyPocket(e="pocket",s=!1){const r=s?window.localStorage:window.sessionStorage,o=t.getAllPocketKeys(e,s);if(!o.length)return console.warn("No pocket keys found for "+e+" in "+r),o;Object.keys(o).forEach((e=>{r.removeItem(o[e])}));const n=t.getAllPocketKeys(e,s).length;return t.#r({pocket:e,keysBefore:o.length,keysRemaining:n,storageArea:t.#o(r),action:"emptyPocket"},!0),n}static tidyPocket(e="pocket",s=!1){const r=s?localStorage:sessionStorage,o=t.getAllPocketKeys(e,s);if(!o.length)return null;Object.keys(o).forEach((e=>{const t=JSON.parse(r.getItem(o[e])).expiry;if(!t||t-Date.now()>0)return null;r.removeItem(o[e])}));const n=t.getAllPocketKeys(e,s).length;return t.#r({pocket:e,keysBefore:o.length,keysRemaining:n,storageArea:t.#o(r),action:"tidyPocket"},!0),n}static getSatchel(e,s="pocket",r=!1){const o=`${t.stcl}.${s}.${e}`,n=r?localStorage:sessionStorage,i=JSON.parse(n.getItem(o));return!!i&&new t(e,i,r,s)}}return t.stcl="stcl",e.Satchel=t,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=Satchel.iife.min.js.map
