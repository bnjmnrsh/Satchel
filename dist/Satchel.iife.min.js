/*! satchel v1.0.0 | (c) 2022 undefined | ISC License | https://github.com/bnjmnrsh/ */
var satchel=function(e){"use strict";class t{#e;#t;#o;#r;constructor(e=null,o={},r=!1,s="pocket"){if(this.#o=r?window.localStorage:window.sessionStorage,!e)throw new Error("Satchel: a key is required.");if(this.stcl=t.stcl,this.#t=`${this.stcl}.${s}.${e}`,this.#r={data:void 0,expiry:null},this.#e={...this.#r,...o},"number"!=typeof this.#e.expiry&&null!==this.#e.expiry)throw new Error("Satchel: Expiry must be null or a number.");Object.defineProperty(this.#e,"creation",{enumerable:!0,writable:!1,value:Date.now()}),this.set(this.#e)}age(){const e=JSON.parse(this.#o.getItem(this.#t));return{age:Date.now()-e.creation,creation:e.creation,expiry:e.expiry,fresh:this.isFresh()}}bin(){const e=this.#o.getItem(this.#t);if(this.#o.removeItem(this.#t),this.#o.getItem(this.#t))throw new Error("Satchel: Failure to bin key: "+this.#t);return t.#s({key:this.#t,oldValue:JSON.parse(e),storageArea:this.#o===localStorage?"LocalStorage":"SessionStorage",action:"bin"}),this.#e=this.#r,!0}get(e=!1){const t=this.#o.getItem(this.#t);return!!t&&(!!(this.isFresh()&&!e||e)&&JSON.parse(t))}set({data:e,expiry:o,creation:r}){if("number"!=typeof this.#e.expiry&&null!==this.#e.expiry)throw new Error("Satchel: Expiry must be null or a number.");if("number"!=typeof this.#e.creation)throw new Error("Satchel: Creation must be null or a number, it should not be set directly.");const s=this.get(!0),i={};if(i.data=e||null,i.expiry=o||this.#e?.expiry||null,!e&&!o&&s)throw new Error(`Satchel: The key ("${this.#t}") already exists in ${this.#o===window.localStorage?"LocalStorage":"SessionStorage"}, and "data" and "expiry" atributes have not been set, set these or create a new unique key.`);if(!e&&s&&r)throw new Error('Satchel: Overwriting a key\'s "creation" property is not allowed.');return i.creation=s?.creation||this.#e.creation,this.#o.setItem(this.#t,JSON.stringify(i)),this.#e={...this.#e,...i},t.#s({key:this.#t,newValue:i,oldValue:s,storageArea:this.#o===localStorage?"LocalStorage":"SessionStorage",action:"set"}),this}isFresh(){const e=JSON.parse(this.#o.getItem(this.#t));return!e?.expiry||e.expiry-Date.now()>0}getKey(){return this.#t}static getAllPocketKeys(e="pocket",t=!1){const o=t?window.localStorage:window.sessionStorage;return Object.keys(o).map((t=>t.startsWith(this.stcl+"."+e)?t:"")).filter((function(e){return e}))}static#s(e={},t=!1){let o={key:null,newValue:null,oldValue:null,storageArea:null,url:window.location.href||null,action:null};t&&(o={pocket:null,keysBefore:null,keysRemaining:null,storageArea:null,url:window.location.href||null,action:null}),e={...o,...e};const r=new CustomEvent("Satchel",{bubbles:!0,cancelable:!0,detail:e});return document.dispatchEvent(r)}static emptyPocket(e="pocket",o=!1){const r=o?window.localStorage:window.sessionStorage,s=t.getAllPocketKeys(e,o);if(!s.length)return console.warn("No pocket keys found for "+e+" in "+r),s;Object.keys(s).forEach((e=>{r.removeItem(s[e])}));const i=t.getAllPocketKeys(e,o);return t.#s({pocket:e,keysBefore:s,keysRemaining:i,storageArea:r===localStorage?"LocalStorage":"SessionStorage",action:"emptyPocket"},!0),i}static tidyPocket(e="pocket",o=!1){const r=o?localStorage:sessionStorage,s=t.getAllPocketKeys(e,o);if(!s.length)return null;Object.keys(s).forEach((e=>{const t=JSON.parse(r.getItem(s[e])).expiry;if(!t||t-Date.now()>0)return null;r.removeItem(s[e])}));const i=t.getAllPocketKeys(e,o).length;return t.#s({pocket:e,keysBefore:s.length,keysRemaining:i,storageArea:r===localStorage?"LocalStorage":"SessionStorage",action:"tidyPocket"},!0),i}static getSatchel(e,o="pocket",r=!1){const s=`${t.stcl}.${o}.${e}`,i=r?localStorage:sessionStorage,a=JSON.parse(i.getItem(s));return!!a&&new t(e,a,r,o)}}return t.stcl="stcl",e.Satchel=t,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=Satchel.iife.min.js.map
