/*! satchel v1.0.0 | (c) 2022 undefined | ISC License | https://github.com/bnjmnrsh/ */
class e{#e;#t;#o;constructor(t=null,o={},r=!1,s="pocket"){if(this.#t=r?window.localStorage:window.sessionStorage,!t)throw new Error("Satchel: a key is required.");this.stcl=e.stcl,this.#e=`${this.stcl}.${s}.${t}`,this.#o={data:void 0,expiry:null},o={...this.#o,...o},this.set(o)}age(){const e=JSON.parse(this.#t.getItem(this.#e));return{age:Date.now()-e.creation,creation:e.creation,expiry:e.expiry,fresh:this.isFresh()}}bin(){const t=this.#t.getItem(this.#e);if(this.#t.removeItem(this.#e),this.#t.getItem(this.#e))throw new Error("Satchel: Failure to bin key: "+this.#e);return e.#r({key:this.#e,oldValue:JSON.parse(t),storageArea:e.#s(this.#t),action:"bin"}),!0}get(e=!1){const t=this.#t.getItem(this.#e);return!!t&&(!!(this.isFresh()&&!e||e)&&JSON.parse(t))}set({data:t,expiry:o,creation:r}){if("number"!=typeof o&&null!==o)throw new Error("Satchel: Expiry must be null or a number.");if(r&&"number"!=typeof r)throw new Error("Satchel: Creation cannot be set directly.");const s=this.get(!0),n={};if(n.data=t||null,n.expiry=o||t?.expiry||null,!t&&!o&&s)throw new Error(`Satchel: The key ("${this.#e}") already exists in ${this.#t===window.localStorage?"LocalStorage":"SessionStorage"}, and "data" and "expiry" atributes have not been set, set these or create a new unique key.`);if(!t&&s&&r)throw new Error('Satchel: Overwriting a key\'s "creation" property is not allowed.');return n.creation=s?.creation||Date.now(),this.#t.setItem(this.#e,JSON.stringify(n)),e.#r({key:this.#e,newValue:n,oldValue:s,storageArea:e.#s(this.#t),action:"set"}),this}isFresh(){const e=JSON.parse(this.#t.getItem(this.#e));return!e?.expiry||e.expiry-Date.now()>0}getKey(){return this.#e}static getAllPocketKeys(e="pocket",t=!1){const o=t?window.localStorage:window.sessionStorage;return Object.keys(o).map((t=>t.startsWith(this.stcl+"."+e)?t:"")).filter((function(e){return e}))}static#s(e){return e===localStorage?"localStorage":"sessionStorage"}static#r(e={},t=!1){let o={key:null,newValue:null,oldValue:null,storageArea:null,url:window.location.href||null,action:null};t&&(o={pocket:null,keysBefore:null,keysRemaining:null,storageArea:null,url:window.location.href||null,action:null}),e={...o,...e};const r=new CustomEvent("Satchel",{bubbles:!0,cancelable:!0,detail:e});return document.dispatchEvent(r)}static emptyPocket(t="pocket",o=!1){const r=o?window.localStorage:window.sessionStorage,s=e.getAllPocketKeys(t,o);if(!s.length)return console.warn("No pocket keys found for "+t+" in "+r),s;Object.keys(s).forEach((e=>{r.removeItem(s[e])}));const n=e.getAllPocketKeys(t,o);return e.#r({pocket:t,keysBefore:s,keysRemaining:n,storageArea:e.#s(r),action:"emptyPocket"},!0),n}static tidyPocket(t="pocket",o=!1){const r=o?localStorage:sessionStorage,s=e.getAllPocketKeys(t,o);if(!s.length)return null;Object.keys(s).forEach((e=>{const t=JSON.parse(r.getItem(s[e])).expiry;if(!t||t-Date.now()>0)return null;r.removeItem(s[e])}));const n=e.getAllPocketKeys(t,o).length;return e.#r({pocket:t,keysBefore:s.length,keysRemaining:n,storageArea:e.#s(r),action:"tidyPocket"},!0),n}static getSatchel(t,o="pocket",r=!1){const s=`${e.stcl}.${o}.${t}`,n=r?localStorage:sessionStorage,i=JSON.parse(n.getItem(s));return!!i&&new e(t,i,r,o)}}e.stcl="stcl";export{e as Satchel};
//# sourceMappingURL=Satchel.min.js.map
