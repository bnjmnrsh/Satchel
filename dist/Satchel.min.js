/* ! @preserve @bnjmnrsh/satchel v0.1.3 | (c) 2022 bnjmnrsh | ISC | https://github.com/bnjmnrsh/satchel */
class e{#e;#t;#r;constructor(t=null,r={},o=!1,n="pocket"){if(this.#t=o?window.localStorage:window.sessionStorage,!t)throw new Error('Satchel: a "key" is required.');if("string"!=typeof t)throw new Error('Satchel: "key" must be a string.');if("object"!=typeof r)throw new Error("Satchel: {cargo} must be an object.");if("boolean"!=typeof o)throw new Error("Satchel: local must be a boolean.");if("string"!=typeof n)throw new Error('Satchel: "pocket" must be an string.');this.stcl=e.stcl,this.#e=`${this.stcl}.${n}.${t}`,this.#r={data:void 0,expiry:null},r={...this.#r,...r},this.set(r)}age(){const e=JSON.parse(this.#t.getItem(this.#e));return e?{age:Number(Date.now()-e.creation),creation:Number(e.creation),expiry:e.expiry?Number(e.expiry):null,fresh:Boolean(this.isFresh())}:null}bin(){const t=this.#t.getItem(this.#e);return t?(this.#t.removeItem(this.#e),e.#o({key:String(this.#e),oldValue:String(t),storageArea:String(e.#n(this.#t)),action:"bin"}),!0):null}get(e=!1){const t=this.#t.getItem(this.#e);return!!t&&(!!(this.isFresh()&&!e||e)&&JSON.parse(t))}set({data:t,expiry:r}){if("number"!=typeof r&&null!==r)throw new Error("Satchel: Expiry must be null or a number.");if(t&&"string"!=typeof t&&"object"!=typeof t)throw new Error("Satchel: Data must be a string or an object.");const o=this.get(!0),n={};if(n.data=t||null,n.expiry=r||null,!t&&!r&&o)throw new Error(`Satchel: The key ("${this.#e}") already exists in ${e.#n(this.#t)}, and "data" and "expiry" atributes have not been set, set these or create a new unique key.`);return n.creation=Number(o.creation)||Date.now(),this.#t.setItem(this.#e,JSON.stringify(n)),e.#o({key:String(this.#e),newValue:JSON.stringify(n),oldValue:o?JSON.stringify(o):null,storageArea:String(e.#n(this.#t)),action:"set"}),this}isFresh(){const e=JSON.parse(this.#t.getItem(this.#e));return e?Boolean(!e?.expiry||e.expiry-Date.now()>0):null}getKey(){return String(this.#e)}static#n(e){return e===window.localStorage?"LocalStorage":"SessionStorage"}static#o(e={},t=!1){let r={key:null,newValue:null,oldValue:null,storageArea:null,url:String(window.location.href),action:null};t&&(r={pocket:null,keysBefore:null,keysRemaining:null,storageArea:null,url:String(window.location.href),action:null}),e={...r,...e};const o=new CustomEvent("Satchel",{bubbles:!0,cancelable:!0,detail:e});return document.dispatchEvent(o)}static emptyPocket(t="pocket",r=!1){const o=r?window.localStorage:window.sessionStorage,n=e.getAllPocketKeys(t,r);Object.keys(n).forEach((e=>{o.removeItem(n[e])}));const s=e.getAllPocketKeys(t,r).length;return e.#o({pocket:t,keysBefore:n.length,keysRemaining:s,storageArea:e.#n(o),action:"emptyPocket"},!0),s}static getAllPocketKeys(e="pocket",t=!1){const r=t?window.localStorage:window.sessionStorage,o=Object.keys(r).map((t=>t.startsWith(this.stcl+"."+e)?t:"")).filter((e=>e));return Array.from(o)}static getSatchel(t,r="pocket",o=!1){if(!t)throw new Error('Satchel: a "key" is required.');if("string"!=typeof t)throw new Error('Satchel: "key" must be a string.');if("string"!=typeof r)throw new Error('Satchel: "pocket" must be an string.');if("boolean"!=typeof o)throw new Error("Satchel: local must be a boolean.");const n=`${e.stcl}.${r}.${t}`,s=o?window.localStorage:window.sessionStorage;let i=JSON.parse(s.getItem(n));return!(!i||0===i.length)&&new e(t,i,o,r)}static tidyPocket(t="pocket",r=!1){const o=r?window.localStorage:window.sessionStorage,n=e.getAllPocketKeys(t,r);if(!n.length)return null;Object.keys(n).forEach((e=>{const t=JSON.parse(o.getItem(n[e])).expiry;if(!t||t-Date.now()>0)return null;o.removeItem(n[e])}));const s=e.getAllPocketKeys(t,r).length;return e.#o({pocket:String(t),keysBefore:Number(n.length),keysRemaining:Number(s),storageArea:String(e.#n(o)),action:"tidyPocket"},!0),s}}e.stcl="stcl";export{e as Satchel};
//# sourceMappingURL=Satchel.min.js.map
